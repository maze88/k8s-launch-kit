{{if .Profile.Multirail}}
{{- /* Create separate MacVLAN networks for each PF interface */ -}}
{{range $i, $pf := .ClusterConfig.PFs}}
{{- if eq $pf.Traffic "east-west"}}
apiVersion: mellanox.com/v1alpha1
kind: MacvlanNetwork
metadata:
  name: {{$.Macvlan.NetworkName}}-{{printf "%c" (add 97 $i)}}
spec:
  networkNamespace: "default"
  master: "{{$pf.NetworkInterface}}"
  mode: "bridge"
  mtu: {{$.Sriov.Mtu}}
  ipam: |
    {
      "type": "nv-ipam",
      "poolName": "{{$.NvIpam.PoolName}}-{{printf "%c" (add 97 $i)}}"
    }
{{if ne $i (sub (len $.ClusterConfig.PFs) 1)}}---{{end}}
{{- end}}
{{- end}}
{{else}}
{{/* Create single shared MacVLAN network for all devices */}}
apiVersion: mellanox.com/v1alpha1
kind: MacvlanNetwork
metadata:
  name: {{.Macvlan.NetworkName}}
spec:
  networkNamespace: "default"
  master: "{{(index .ClusterConfig.PFs 0).NetworkInterface}}"
  mode: "bridge"
  mtu: {{.Sriov.Mtu}}
  ipam: |
    {
      "type": "nv-ipam",
      "poolName": "{{.NvIpam.PoolName}}"
    }
{{end}}